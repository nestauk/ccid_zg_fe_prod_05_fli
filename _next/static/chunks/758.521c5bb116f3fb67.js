(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[758],{34776:e=>{e.exports={slideWrapControl:"previews_slideWrapControl__IsWaW"}},85758:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>S});var n=t(95155),i=t(14595),l=t(41964),s=t(25148),o=t(25789),a=t(80357),c=t(27855),u=t(75970),d=t(98638),p=t(80317),h=t(20097),g=t.n(h),f=t(23311),A=t(7496),b=t.n(A),m=t(12115),x=t(4612),v=t(80431),w=t(39268),j=t(33018),y=t.n(j);let I=e=>y().createHash("sha1").update(e).digest("base64");var C=t(34776),R=t.n(C);function S(e){let r=(0,o.A)(),t=(0,m.useRef)(null),h=(0,m.useRef)(null),A=(0,m.useRef)(null),j=(0,m.useRef)(null),y=(0,m.useRef)(null),C=(0,m.useRef)(0),S=(0,m.useRef)(!1),D=(0,m.useRef)([]),k=(0,m.useRef)(null),E=(0,m.useRef)(null),[W,G]=(0,m.useState)(!1),[P,B]=(0,m.useState)(!1),{revealIndex:Z,setTargetIndex:z}=(0,v.nI)(),L=(0,m.useRef)(e.regenerateThumbnails);(0,m.useEffect)(()=>{if(!0!==S.current&&null!==A.current)if(S.current=!0,W||k.current||!window.indexedDB)H();else{let e=window.indexedDB.open("deliberation-thumbnails-by-sid",2);e.onupgradeneeded=e=>{e.target.result.createObjectStore("thumbnails",{keyPath:"sid"}).createIndex("sid","sid",{unique:!0})},e.onsuccess=r=>{t.current=e.result,N()}}},[e.sid,e.slides,A.current,W]);let N=()=>{if(L.current)k.current=null,H();else{let r=t.current.transaction(["thumbnails"],"readonly").objectStore("thumbnails").get(e.sid);r.onerror=e=>{console.warn("preload thumbnail error",e),H()},r.onsuccess=t=>{var n,i;console.debug("Retrieved thumbnails");let l=I(e.sourcePresentationXml);console.debug("Slides XML hash: ".concat(l)),console.debug("ObjectStore XML hash: ".concat(null==(n=r.result)?void 0:n.hash)),(null==(i=r.result)?void 0:i.hash)===l&&(k.current=r.result),H()}}},H=()=>{var r;(k.current=null!=(r=k.current)?r:{sid:e.sid,hash:I(e.sourcePresentationXml),previews:[]},k.current.previews.length>0&&!L)?(console.debug("Restored ".concat(k.current.previews.length," previews from local storage")),G(!0)):(console.debug("No previews in local storage - generating new previews."),console.log("revealDivRef",A.current),h.current=new x.A(A.current,{embedded:!0,controls:!1,keyboard:!1,touch:!1,overview:!1,help:!1,hideInactiveCursor:!1,showNotes:!1,plugins:[],transitionSpeed:"fast"}),h.current.initialize({progress:!1,autoPlayMedia:!1,scrollActivationWidth:void 0}).then(()=>{console.debug("Reveal ready"),h.current.slide(0),h.current.on("slidetransitionend",T),C.current=h.current.getHorizontalSlides().length,D.current=[...Array(C.current).fill(0).map((e,r)=>r)],O()})),L.current=!1},O=()=>{if(!(D.current.length>0))return!1;{let e=D.current.shift();return console.debug("initialising thumbnail for slide ".concat(e,"...")),setTimeout(()=>{J(e)},100),!0}},J=e=>{console.debug("Triggering generation ".concat(e,"...")),h.current.getIndices().h!==e?(console.debug("Sending slide from ".concat(h.current.getIndices().h," to ").concat(e,"...")),h.current.slide(e)):(console.debug("Slide already in position ".concat(e,".")),setTimeout(()=>{K()},1e3))},T=e=>{console.debug("onSlideTransitionEnd at: ".concat(h.current.getIndices().h)),setTimeout(()=>{K()},1e3)},[X,Q]=(0,m.useState)(),K=()=>{let e=h.current.getIndices().h;console.debug("Capturing thumbnail for slide at index: ".concat(e));let r=h.current.getCurrentSlide();r.style.top="0px",(0,f.$E)(r,{cacheBust:!1,imagePlaceholder:"data:image/gif;base64,R0lGODlhGQAZAPQAAISChKWipcbT7+fr/8bf51KuOdbf93vDc87b9/f3997n/2u2Y9bf/5SSlJzHtcbT9////+/z/1KyOdbj94zHjNbb9/f3/2u6Y9bj/5yenLXP1sbX9wAAAAAAAAAAAAAAACH/C1hNUCBEYXRhWE1QPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+ICAgPD94cGFja2V0IGVuZD0idyI/PgH//v38+/r5+Pf29fTz8vHw7+7t7Ovq6ejn5uXk4+Lh4N/e3dzb2tnY19bV1NPS0dDPzs3My8rJyMfGxcTDwsHAv769vLu6ubi3trW0s7KxsK+urayrqqmop6alpKOioaCfnp2cm5qZmJeWlZSTkpGQj46NjIuKiYiHhoWEg4KBgH9+fXx7enl4d3Z1dHNycXBvbm1sa2ppaGdmZWRjYmFgX15dXFtaWVhXVlVUU1JRUE9OTUxLSklIR0ZFRENCQUA/Pj08Ozo5ODc2NTQzMjEwLy4tLCsqKSgnJiUkIyIhIB8eHRwbGhkYFxYVFBMSERAPDg0MCwoJCAcGBQQDAgEAACwAAAAAGQAZAAAF/2DgWGRpmlkTaIkFvWIkzzSdZY42JS8UBIqJcEicKBSZAGSSIfB8AaHBMBlYB5OpMAlJaAhOyy+LKLsgljKCyn1pMruxATGI9CARxZqZ0fgDKg5yCHZ3EAN7KQ2LjA1JVWeGiGVCV1aAjwOGPZN0dTNijlFzaqWlWlQKA5hRCBuvsLGnWgqsEwgCsLmxurAIE7a4rwLEucW7u78EGmO4x8/QAr8uj87PfhrRCmfV0djRmi/dxA4OC+foF34CE4bjAuUFBRL05zkICj0JCd0a5vQAAx4wZEuAPwoLAgYs18NCBFsEHBxQqPDJCyyAfiw7kJCiBAcE9H0BpiJARI8AQyL2IKCOZIAMFCZ6dLDvRYKYEig4SPHywAWUGu4kAHiAwqIQADs="}).then(r=>{k.current.previews[e]={pngDataUrl:r},O()||M()}).catch(r=>{console.error("error capturing element",r),k.current.previews[e]={pngDataUrl:"/icons/broken-image-placeholder.png"},O()||M()}).finally(()=>{Q({generated:e,total:C.current})})},M=()=>{console.debug("Completed preview generation"),console.debug("Storing thumbnails...");let e=t.current.transaction(["thumbnails"],"readwrite").objectStore("thumbnails").put(k.current);e.onerror=e=>{var r;console.warn("Error storing thumbnails",e),null==(r=h.current)||r.destroy(),h.current=null,G(!0),S.current=!1},e.onsuccess=e=>{var r;console.debug("Stored thumbnails",e),null==(r=h.current)||r.destroy(),h.current=null,G(!0),S.current=!1}};return(0,m.useEffect)(()=>{if(W&&E){var e;null==(e=E.current)||e.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}}),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.A,{sx:{display:"block",overflowX:"scroll"},children:(0,n.jsxs)(a.A,{sx:{display:"flex",flexDirection:"row",gap:1,textWrap:"nowrap",whiteSpace:"nowrap",flexWrap:"nowrap"},children:[W&&k.current.previews.map((e,t)=>(0,n.jsx)(a.A,{sx:{padding:1,border:Z===t?"solid 2px":"solid 1px",borderColor:Z===t?r.palette.primary.main:r.palette.divider,borderRadius:1,width:"auto",height:"auto",display:"inline-block"},onClick:()=>z(t),children:(0,n.jsx)("img",{ref:Z===t?E:void 0,src:e.pngDataUrl,width:150,height:"auto"},"presentation-preview-image-".concat(t))},"presentation-preview-".concat(t))),W&&(0,n.jsxs)(a.A,{sx:{padding:0,width:"auto",height:"auto",display:"flex",flexDirection:"column",gap:1},children:[(0,n.jsx)(c.A,{disabled:!W,variant:"outlined",color:"info",onClick:()=>z(0),startIcon:(0,n.jsx)(l.A,{}),children:"Back to start"}),(0,n.jsx)(c.A,{disabled:!W,variant:"outlined",color:"info",onClick:()=>void B(!0),startIcon:(0,n.jsx)(s.A,{}),children:"Refresh previews"}),(0,n.jsx)(c.A,{disabled:!W,variant:"outlined",color:"info",onClick:()=>{let r;return r=new(b()),void(k.current.previews.forEach((e,t)=>{r.file("slide-".concat(t,".png"),e.pngDataUrl.split("base64,")[1],{base64:!0})}),r.generateAsync({type:"blob"}).then(function(r){g()(r,"slides-".concat(e.sid,".zip"))}))},startIcon:(0,n.jsx)(i.A,{}),children:"Download slides"})]})]})}),(0,n.jsx)(a.A,{sx:{maxWidth:"100%",overflowX:"scroll",display:"flex",flexDirection:"row",flexWrap:"nowrap",gap:1,m:0,p:0,alignItems:"stretch"},children:!W&&(0,n.jsx)(a.A,{ref:y,sx:{flexGrow:1,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:120},children:(0,n.jsxs)(u.A,{elevation:1,sx:{flexDirection:"row",display:"flex",alignItems:"center",gap:1,p:2},children:[(0,n.jsxs)(a.A,{sx:{width:"75px",height:"auto",aspectRatio:"".concat(150," / ").concat(120),border:"solid 1px",borderRadius:"0.5rem",overflow:"hidden",borderColor:r.palette.primary.main,position:"relative"},children:[(0,n.jsx)("div",{className:"reveal",ref:A,children:(0,n.jsx)("div",{className:"slides ".concat(R().slideWrapControl),ref:j,children:e.slides})}),(0,n.jsx)(a.A,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",background:"rgba(255, 255, 255, 0.5)",zIndex:100},children:(0,n.jsx)(d.A,{size:"1.5rem",value:X?X.generated/X.total*100:0,variant:X?"determinate":"indeterminate"})})]}),(0,n.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",gap:0},children:[(0,n.jsx)(p.A,{variant:"body1",children:"Please wait"}),(0,n.jsx)(p.A,{variant:"body2",children:"Generating previews..."})]})]})})}),(0,n.jsx)(w.A,{title:"Refresh slide previews?",prompt:"This will update all slide previews for this presentation. It could take several minutes.",dismissible:!0,options:[{key:"refresh",text:"Refresh",filled:!0},{key:"cancel",text:"Cancel",filled:!1}],onSelect:e=>{"refresh"===e&&(L.current=!0,k.current=null,G(!1))},open:P,setOpen:B})]})}}}]);