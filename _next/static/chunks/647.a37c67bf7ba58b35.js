(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[647],{54854:function(e,i,t){var l,o,a;o="undefined"!=typeof self?self:"undefined"!=typeof window?window:this,a=function(e,i){"use strict";var t,l=e.createElement("test"),o=e.documentElement,a=e.defaultView,s=a&&a.getComputedStyle,n=/^(-?[\d+\.\-]+)([a-z]+|%)$/i,r={},d=[1/25.4,1/2.54,1/72,1/6],p=["mm","cm","pt","pc","in","mozmm"],c=6;for(o.appendChild(l),s&&(l.style.marginTop="1%",t="1%"===s(l).marginTop);c--;)r[p[c]+"toPx"]=d[c]?d[c]*r.inToPx:x(l,"1"+p[c]);function x(e,t,l,a){l=l||"width";var s,d,p,c=(t.match(n)||[])[2],x="px"===c?1:r[c+"toPx"];if(x||/r?em/i.test(c)&&!a)e=x?e:"rem"===c?o:"fontSize"===l&&e.parentNode||e,x=x||parseFloat(h(e,"fontSize")),p=parseFloat(t)*x;else{d=(s=e.style)[l];try{s[l]=t}catch(e){return 0}p=s[l]?parseFloat(h(e,l)):0,s[l]=i!==d?d:null}return p}function h(e,i){var l,o,a,r,d,p=["paddingTop","paddingBottom","borderTop","borderBottom"],c=4;if("%"===(a=((l=s?s(e)[i]:(o=e.style["pixel"+i.charAt(0).toUpperCase()+i.slice(1)])?o+"px":"fontSize"===i?x(e,"1em","left",1)+"px":e.currentStyle[i]).match(n)||[])[2])&&t)if(/^top|bottom/.test(i)){for(r=(d=e.parentNode||e).offsetHeight;c--;)r-=parseFloat(h(d,p[c]));l=parseFloat(l)/100*r+"px"}else l=x(e,l);else("auto"===l||a&&"px"!==a)&&s?l=0:a&&"px"!==a&&!s&&(l=x(e,l)+"px");return l}return o.removeChild(l),l=i,{toPx:x}},void 0===(l=(function(){return a(o.document)}).call(i,t,i,e))||(e.exports=l)},72647:(e,i,t)=>{"use strict";t.r(i),t.d(i,{default:()=>v});var l=t(95155),o=t(18932),a=t(54884),s=t(90073),n=t(12115),r=t(46671),d=t.n(r),p=t(54854);let c=(e,i,t,l)=>{let o=Math.min(i,e.videoTiles.length),a=(0,p.toPx)(t,e.gap),s=(0,p.toPx)(t,e.minTileWidth);return{available:{width_px:e.availableWidth_px,height_px:e.availableHeight_px,area_px:e.availableWidth_px*e.availableHeight_px},cols:l,videoTiles:o,slideSpan:e.slideSpan,dimensions:{minTileWidth_px:s,gap_px:a,aspectRatio:e.aspectRatio}}},x=(e,i,t)=>i>0?(e-t*(i-1))/i:e,h=(e,i,t)=>e*i+(e-1)*t,g=(e,i)=>{let t=e.slideSpan.cols*e.slideSpan.rows,l=t+e.videoTiles,o=Math.max(e.slideSpan.rows,Math.ceil(l/e.cols)),{tileWidth_px:a,tileHeight_px:s}=f(e.available.width_px,e.available.height_px,e.cols,o,e.dimensions.aspectRatio,e.dimensions.gap_px),n=e.available.width_px*e.available.height_px,r=h(e.cols,a,e.dimensions.gap_px),d=h(o,s,e.dimensions.gap_px),p=r*d,c=d<e.available.height_px,x=a>e.dimensions.minTileWidth_px,g=e.cols*o-t,b=Math.min(e.videoTiles,g,25),v={for:e,tile:{width_px:a,height_px:s,area_px:a*s},grid:{rows:o,cols:e.cols,rowWidth_px:r,colHeight_px:d,area_px:p},page:{spaces:g,videoTiles:b,emptySpaces:g-b},checks:{fitsByHeight:c,fitsByArea:p<n,tileSizeAboveMin:x}},_=u(i,v);return{calculation:v,score:_}},f=(e,i,t,l,o,a)=>{let s=x(e,t,a),n=x(i,l,a),r=s/o;return h(l,r,a)<=i?{tileWidth_px:s,tileHeight_px:r}:{tileWidth_px:n*o,tileHeight_px:n}},u=(e,i)=>{switch(e){case 0:return i.tile.width_px;case 1:return i.tile.area_px;case 2:return 1-(i.for.available.area_px-i.grid.area_px)}},b=(e,i,t)=>{let l=x(e.availableWidth_px,e.slideSpan.cols,i),o=x(e.availableHeight_px,e.slideSpan.rows,i),a=l*o,s=e.availableWidth_px*e.availableHeight_px,n=h(e.slideSpan.cols,l,i),r=h(e.slideSpan.rows,o,i);return{for:{available:{width_px:e.availableWidth_px,height_px:e.availableHeight_px,area_px:s},cols:e.slideSpan.cols,videoTiles:0,slideSpan:e.slideSpan,dimensions:{minTileWidth_px:t,gap_px:i,aspectRatio:e.aspectRatio}},tile:{width_px:l,height_px:o,area_px:a},page:{spaces:0,videoTiles:0,emptySpaces:0},grid:{rows:e.slideSpan.rows,cols:e.slideSpan.cols,rowWidth_px:n,colHeight_px:r,area_px:n*r},checks:{fitsByHeight:r<=e.availableHeight_px,fitsByArea:a<s,tileSizeAboveMin:l>=t}}};function v(e){let i=(0,n.useRef)(null),[t,s]=(0,n.useState)(),[r,x]=(0,n.useState)([]);return(0,n.useEffect)(()=>{(0,a.s)(t)&&x(((e,i)=>{let t=e.filter(e=>e.role===o.sW.Controller||e.local);if(i.page.videoTiles>t.length){console.info("Paging with fixed tiles");let l=e.filter(e=>!t.includes(e)),o=i.page.videoTiles-t.length,a=d().chunk(l,o).map(e=>({grid:i,videoTiles:t.concat(e)}));return console.info(a),a}{console.info("No room for fixed tiles, paging all tiles");let t=i.page.videoTiles,l=d().chunk(e,t).map(e=>({grid:i,videoTiles:e}));return console.info(l),l}})(e.videoTiles,t))},[t]),(0,n.useEffect)(()=>{e.updateTotalPages(r.length)},[r]),(0,n.useEffect)(()=>{(0,a.s)(i.current)?(console.info("ZgVideoCallGrid: calculating grid properties for ".concat(e.videoTiles.length," tiles...")),s(((e,i)=>{let t,l;console.info("request: ".concat(e.videoTiles.length," tiles"));let o=Math.min(25,e.videoTiles.length),a=o+e.slideSpan.cols,s=(0,p.toPx)(i,e.gap),n=(0,p.toPx)(i,e.minTileWidth);if(0===e.videoTiles.length)return b(e,s,n);for(let o=e.slideSpan.cols;o<=Math.max(a,e.slideSpan.cols);o++){let{calculation:a,score:s}=g(c(e,25,i,o),0),r=n<=a.tile.width_px,d=a.checks.fitsByHeight&&a.checks.fitsByArea,p=s>(null!=l?l:0);r&&d&&p&&(t=a,l=s)}if(t)return console.info("Best grid solution found"),console.debug(t),{...t,for:{...t.for,videoTiles:e.videoTiles.length}};{console.info("Falling back to reducing the number of tiles that can be viewed");let i=((e,i,t,l,o)=>{let a;for(let s=l;s<=o;s++)if(h(s,i,t)<=e)a=s;else break;return null!=a?a:l})(e.availableWidth_px,n,s,e.slideSpan.cols,a);for(let t=o;t>=0;t--){let l=g({...{available:{width_px:e.availableWidth_px,height_px:e.availableHeight_px,area_px:e.availableWidth_px*e.availableHeight_px},cols:i,videoTiles:o,slideSpan:e.slideSpan,dimensions:{minTileWidth_px:n,gap_px:s,aspectRatio:e.aspectRatio}},videoTiles:t},0).calculation;if(l.checks.tileSizeAboveMin)return console.info("Found a solution with ".concat(t," tiles")),console.debug(l),{...l,for:{...l.for,videoTiles:o}}}return console.warn("No suitable grid solution found"),b(e,s,n)}})(e,i.current))):console.warn("ZgVideoCallGrid: eleRef.current is not defined")},[e,i]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{style:{display:"none"},ref:i}),(0,a.s)(t)&&(0,l.jsx)(_,{inputs:e,pages:r,calculations:t,pageIndex:e.pageIndex})]})}function _(e){let{inputs:i,pages:t,calculations:n,pageIndex:r}=e,d={display:"grid",maxWidth:i.availableWidth_px,maxHeight:i.availableHeight_px,gridAutoFlow:"row",gridTemplateColumns:"repeat(auto-fit, ".concat(n.tile.width_px,"px)"),gap:i.gap,overflow:"hidden"},p={objectFit:"contain",width:"".concat(n.tile.width_px,"px"),height:"".concat(n.tile.height_px,"px"),boxSizing:"border-box",border:"solid 1px grey",positionVisibility:"no-overflow",padding:"0.5rem",borderRadius:"0.4rem",backgroundColor:"darkgrey",color:"white",overflow:"hidden"},c={objectFit:"contain",width:"".concat(n.tile.width_px,"px"),height:"".concat(n.tile.height_px,"px"),boxSizing:"border-box",border:"solid 1px grey",positionVisibility:"no-overflow",padding:"0.5rem",borderRadius:"0.4rem",backgroundColor:"darkgrey",color:"white",overflow:"hidden",opacity:.5},x={...p,width:"".concat(n.tile.width_px*i.slideSpan.cols+n.for.dimensions.gap_px*(i.slideSpan.cols-1),"px"),height:"".concat(n.tile.height_px*i.slideSpan.rows+n.for.dimensions.gap_px*(i.slideSpan.rows-1),"px"),gridRowEnd:"span ".concat(i.slideSpan.rows),gridColumnEnd:"span ".concat(i.slideSpan.cols),overflow:"hidden",padding:"0.5rem",borderRadius:"0.4rem",backgroundColor:"white",color:"black"},h=t[Math.max(0,Math.min(r,t.length-1))],g=t.length>0?h:{grid:n,videoTiles:[]};return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)(s.A,{sx:d,children:[(0,l.jsx)(s.A,{sx:x,children:(0,l.jsxs)(s.A,{sx:{maxWidth:"100%",maxHeight:"100%",overflow:"auto"},children:[(0,l.jsx)("b",{children:"Slide"}),(0,l.jsxs)("p",{children:[(0,l.jsx)("b",{children:"Max video tiles per page:"})," ",25,(0,l.jsx)("br",{}),(0,l.jsx)("b",{children:"Min tile width:"})," ",i.minTileWidth," (",n.for.dimensions.minTileWidth_px.toFixed(1),"px)",(0,l.jsx)("br",{}),n.for.videoTiles<=n.page.videoTiles?(0,l.jsx)("span",{style:{color:"green",fontWeight:"bold"},children:"All tiles shown"}):(0,l.jsx)("span",{style:{color:"red",fontWeight:"bold"},children:"Cannot show all tiles"}),(0,l.jsx)("br",{}),"Grid: ",n.grid.cols," cols x ",n.grid.rows," rows",(0,l.jsx)("br",{}),"Available space: ","".concat(i.availableWidth_px," x ").concat(i.availableHeight_px),(0,l.jsx)("br",{}),"Tile dimensions:"," ","".concat(n.tile.width_px.toFixed(1)," x ").concat(n.tile.height_px.toFixed(1)),(0,l.jsx)("br",{}),"Tiles requested: ",n.for.videoTiles,(0,l.jsx)("br",{}),"Spaces per page: ",n.page.spaces,(0,l.jsx)("br",{}),"Tiles per page: ",n.page.videoTiles,(0,l.jsx)("br",{}),"Page: ",r]})]})}),(0,a.s)(g)&&g.videoTiles.map(e=>(0,l.jsxs)(s.A,{sx:p,children:[(0,l.jsx)("b",{children:e.name}),(0,l.jsx)("br",{}),"Tile: #",e.index+1,(0,l.jsx)("br",{}),"Role: ",o.sW[e.role],e.local&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("br",{}),"Local video stream"]})]},"tile-".concat(e.index))),(0,a.s)(g)&&Array.from({length:g.grid.page.videoTiles-g.videoTiles.length},(e,i)=>i).map(e=>(0,l.jsx)(s.A,{sx:c},"empty-tile-".concat(e)))]})})}}}]);